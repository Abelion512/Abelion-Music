<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Detail Lagu - Abelion Music Player</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#000000" />
  <link rel="icon" href="Icon.jpg" type="image/jpg">
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #000;
      color: #fff;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    .bg-blur, .bg-video {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      width: 100%; height: 100%;
      object-fit: cover;
      z-index: -1;
      transition: opacity 0.6s ease;
    }
    .bg-video.hidden, .bg-blur.hidden, .album-art.hidden {
      opacity: 0;
      pointer-events: none;
    }
    .container {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      position: relative;
      transition: all 0.5s ease;
    }
    .back-button {
      position: absolute;
      top: 1rem;
      left: 1rem;
      background: transparent;
      border: none;
      font-size: 1.2rem;
      padding: 0.5rem 1rem;
      color: white;
      border-radius: 6px;
      background-color: #222;
      cursor: pointer;
    }
    .menu-button {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: transparent;
      border: none;
      font-size: 1.5rem;
      color: white;
      cursor: pointer;
    }
    .popup-menu {
      position: absolute;
      top: 3rem;
      right: 1rem;
      background-color: #222;
      border-radius: 10px;
      padding: 0.5rem;
      display: none;
      flex-direction: column;
      gap: 0.5rem;
      z-index: 100;
    }
    .popup-menu button {
      background: none;
      border: none;
      color: white;
      text-align: left;
      cursor: pointer;
      padding: 0.5rem 1rem;
    }
    .album-art {
      width: 80%;
      max-width: 300px;
      border-radius: 1rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      transition: opacity 0.5s ease;
    }
    .song-info {
      text-align: center;
      margin: 1rem 0;
    }
    .progress-container {
      width: 90%;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin: 1rem 0;
    }
    .progress-container input { width: 100%; }
    .controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1.2rem;
      margin: 1rem 0;
    }
    .controls button {
      background-color: #222;
      border: none;
      color: white;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 1.2rem;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
    }
    .controls .main {
      width: 65px;
      height: 65px;
      font-size: 1.5rem;
    }
    .controls .active {
      background-color: #1db954;
    }
    .lyric-toggle {
      margin-top: 1rem;
      text-align: center;
      font-size: 1rem;
      color: #aaa;
      cursor: pointer;
      text-decoration: underline;
      transition: color 0.3s;
    }
    .lyric-toggle:hover {
      color: #fff;
    }
    .lyric-popup {
      position: fixed;
      bottom: -100%;
      left: 0; right: 0;
      background-color: rgba(0, 0, 0, 0.9);
      height: 60vh;
      transition: bottom 0.3s ease;
      padding: 1rem;
      overflow-y: auto;
      z-index: 20;
    }
    .lyric-popup.show { bottom: 0; }
    .lyric-popup .lyric-back {
      margin-bottom: 1rem;
      background: transparent;
      border: none;
      color: white;
      font-size: 1rem;
      cursor: pointer;
    }
    .lyric-line {
      margin: 0.3rem 0;
      font-size: 1rem;
      color: #ccc;
      transition: color 0.3s ease;
      cursor: pointer;
    }
    .lyric-line:hover {
      color: #fff;
    }
    .lyric-line.active {
      color: #fff;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <video autoplay muted loop id="bgVideo" class="bg-video">
    <source src="video/doit_bg.mp4" type="video/mp4" />
  </video>
  <img src="image/doit.jpeg" class="bg-blur" id="bgImage" />
  <div class="container" id="playerContainer">
    <button class="back-button" onclick="window.location.href='index.html'">&lt;</button>
    <button class="menu-button" onclick="toggleMenu()">⋮</button>
    <div class="popup-menu" id="popupMenu">
      <button onclick="toggleVideo()">Toggle Video</button>
      <button onclick="adjustVolume(0.1)">Volume +</button>
      <button onclick="adjustVolume(-0.1)">Volume -</button>
      <button onclick="shareSong()">Share</button>
    </div>
    <img id="albumArt" class="album-art" src="doit.jpeg" alt="cover" />
    <div class="song-info">
      <h2 id="title"></h2>
      <p id="artist"></p>
    </div>
    <div class="progress-container">
      <span id="currentTime">0:00</span>
      <input type="range" id="seekBar" value="0" min="0" />
      <span id="duration">0:00</span>
    </div>
    <div class="controls">
      <button id="shuffleBtn" onclick="toggleShuffle()">S</button>
      <button onclick="prevSong()">⏮</button>
      <button class="main" onclick="togglePlayPause()" id="playPause">▶</button>
      <button onclick="nextSong()">⏭</button>
      <button id="repeatBtn" onclick="toggleRepeat()">R</button>
    </div>
    <div class="lyric-toggle" onclick="toggleLyrics()">Show Lyrics</div>
    <div class="lyric-popup" id="lyricPopup">
      <button class="lyric-back" onclick="toggleLyrics()">← Back</button>
      <div id="lyricLines"></div>
    </div>
  </div>
  <audio id="audio"></audio>
  <script>
    const audio = document.getElementById("audio");
    const playPause = document.getElementById("playPause");
    const title = document.getElementById("title");
    const artist = document.getElementById("artist");
    const albumArt = document.getElementById("albumArt");
    const bgVideo = document.getElementById("bgVideo");
    const bgImage = document.getElementById("bgImage");
    const playerContainer = document.getElementById("playerContainer");
    const seekBar = document.getElementById("seekBar");
    const currentTime = document.getElementById("currentTime");
    const duration = document.getElementById("duration");
    const lyricPopup = document.getElementById("lyricPopup");
    const lyricLines = document.getElementById("lyricLines");
    const shuffleBtn = document.getElementById("shuffleBtn");
    const repeatBtn = document.getElementById("repeatBtn");
    const popupMenu = document.getElementById("popupMenu");

    const songs = [
      { title: "Sample Song 1", artist: "Artist One", file: "music/song1.mp3" },
      { title: "Sample Song 2", artist: "Artist Two", file: "music/song2.mp3" },
      { title: "Sample Song 3", artist: "Artist Three", file: "music/song3.mp3" },
      { title: "Sample Song 4", artist: "Artist Four", file: "music/song4.mp3" },
      { title: "Sample Song 5", artist: "Artist Five", file: "music/song5.mp3" },
      { title: "Sample Song 6", artist: "Artist Six", file: "music/song6.mp3"},
    ];

    let currentIndex = parseInt(localStorage.getItem("selectedIndex")) || 0;
    let repeatMode = 0;
    let isShuffle = false;
    let showVideo = false;
    let lyrics = [];

    function loadSong(index) {
      const song = songs[index];
      title.textContent = song.title;
      artist.textContent = song.artist;
      audio.src = song.file;
      albumArt.src = "image/doit.jpeg";
      lyrics = getLyrics(song.title);
      updateLyrics(0);
    }

    function togglePlayPause() {
      if (audio.paused) {
        audio.play();
        playPause.textContent = "⏸";
      } else {
        audio.pause();
        playPause.textContent = "▶";
      }
    }

    function nextSong() {
      currentIndex = (currentIndex + 1) % songs.length;
      localStorage.setItem("selectedIndex", currentIndex);
      loadSong(currentIndex);
      audio.play();
    }

    function prevSong() {
      currentIndex = (currentIndex - 1 + songs.length) % songs.length;
      localStorage.setItem("selectedIndex", currentIndex);
      loadSong(currentIndex);
      audio.play();
    }

    function toggleRepeat() {
      repeatMode = (repeatMode + 1) % 4;
      repeatBtn.classList.toggle("active", repeatMode !== 0);
    }

    function toggleShuffle() {
      isShuffle = !isShuffle;
      shuffleBtn.classList.toggle("active", isShuffle);
    }

    function toggleMenu() {
      popupMenu.style.display = popupMenu.style.display === "flex" ? "none" : "flex";
    }

    function toggleVideo() {
      showVideo = !showVideo;
      bgVideo.classList.toggle("hidden", !showVideo);
      bgImage.classList.toggle("hidden", showVideo);
      albumArt.classList.toggle("hidden", showVideo);
    }

    function adjustVolume(change) {
      audio.volume = Math.min(1, Math.max(0, audio.volume + change));
    }

    function shareSong() {
      if (navigator.share) {
        navigator.share({
          title: title.textContent,
          text: `Now playing: ${title.textContent} by ${artist.textContent}`,
          url: location.href
        });
      }
    }

    function formatTime(t) {
      const m = Math.floor(t / 60);
      const s = Math.floor(t % 60).toString().padStart(2, '0');
      return `${m}:${s}`;
    }

    audio.addEventListener("loadedmetadata", () => {
      seekBar.max = audio.duration;
      duration.textContent = formatTime(audio.duration);
    });

    audio.addEventListener("timeupdate", () => {
      seekBar.value = audio.currentTime;
      currentTime.textContent = formatTime(audio.currentTime);
      updateLyrics(audio.currentTime);
    });

    seekBar.addEventListener("input", () => audio.currentTime = seekBar.value);

    function toggleLyrics() {
      lyricPopup.classList.toggle("show");
    }

    function getLyrics(title) {
      // Sample lyrics structure - replace with your own original content
      if (title === "Sample Song 1") {
        return [
          { time: 7.1, text: "Sample lyric line 1" },
          { time: 12, text: "Sample lyric line 2" },
          { time: 22.6, text: "Sample lyric line 3" },
        ];
      }
      if (title === "Sample Song 2") {
        return [
          { time: 1.5, text: "Another sample lyric" },
          { time: 5.5, text: "Second line of sample" },
          { time: 9, text: "Third sample line" },
        ];
      }
      return [];
    }

    function updateLyrics(current) {
      lyricLines.innerHTML = lyrics.map((line, i) => {
        const next = lyrics[i + 1]?.time || Infinity;
        const active = current >= line.time && current < next;
        return `<div class="lyric-line${active ? ' active' : ''}" onclick="audio.currentTime=${line.time}">${line.text}</div>`;
      }).join("");
    }

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(() => console.log('✅ Service Worker registered'))
        .catch(err => console.error('❌ SW failed', err));
    }
    
    loadSong(currentIndex);

  </script>
</body>
</html>
